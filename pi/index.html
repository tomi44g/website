<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.7.0/firebase.js"></script>
  
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawChart);

      function drawChart() {

        // Initialize Firebase
        var config = {
          apiKey: "AIzaSyAnU0SI-NcBOYwuf8TQBpMcdUgtd8zrpA4",
          authDomain: "deep-scoring.firebaseapp.com",
          databaseURL: "https://deep-scoring.firebaseio.com",
          projectId: "deep-scoring",
          storageBucket: "deep-scoring.appspot.com",
          messagingSenderId: "828272673888"
        };
      
        firebase.initializeApp(config);
        var sensors = firebase.database().ref("sensors");
        sensors.child("latest").once("value").then(function(snapshot) {
          latest = snapshot.val()
          $('#temp').text('Temperature: ' + latest['temp'] + '°C');
          $('#rh').text('Humidity: ' + latest['rh'] + '%');
          $('#timestamp').text('Values as of: ' + latest['time']);
        });
        
        
        dataQuery = sensors.child("data").orderByKey().limitToLast(1000).once("value").then(function(snapshot) {
          dataArray = [
            ['Time', 'Temperature']
          ];

          var dataPoints = snapshot.val();
          Object.keys(dataPoints).forEach(function(key) {
            var dp = dataPoints[key]
            dataArray.push([dp['time'], dp['temp']])
          });
          
          var data = google.visualization.arrayToDataTable(dataArray);

          var options = {
            title: 'Company Performance',
            curveType: 'function',
            legend: { position: 'bottom' }
          };

          var chart = new google.visualization.LineChart(document.getElementById('curve_chart'));

          chart.draw(data, options);

        });
        
      }
    </script>
  </head>
  <body>
    <div id="temp">0°</div>
    <div id="rh">0%</div>
    <div id="timestamp">2018-01-01</div>
    <div id="curve_chart" style="width: 900px; height: 500px"></div>
  </body>
</html>